<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JS多文件下载 | walljay的备忘博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="js&amp;#x4E0B;&amp;#x8F7D;/**
 * Javascript &amp;#x591A;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0B;&amp;#x8F7D;
 * @author Barret Lee
 * @email  barret.china@gmail.com
 */
var Downer = (function(files) {
var h5Down = !/Trident|MSIE/.te">
<meta property="og:type" content="article">
<meta property="og:title" content="JS多文件下载">
<meta property="og:url" content="dujiecn.github.io/2016/09/08/JS多文件下载/index.html">
<meta property="og:site_name" content="walljay的备忘博客">
<meta property="og:description" content="js&amp;#x4E0B;&amp;#x8F7D;/**
 * Javascript &amp;#x591A;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0B;&amp;#x8F7D;
 * @author Barret Lee
 * @email  barret.china@gmail.com
 */
var Downer = (function(files) {
var h5Down = !/Trident|MSIE/.te">
<meta property="og:updated_time" content="2016-09-08T06:11:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JS多文件下载">
<meta name="twitter:description" content="js&amp;#x4E0B;&amp;#x8F7D;/**
 * Javascript &amp;#x591A;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0B;&amp;#x8F7D;
 * @author Barret Lee
 * @email  barret.china@gmail.com
 */
var Downer = (function(files) {
var h5Down = !/Trident|MSIE/.te">
  
    <link rel="alternative" href="/atom.xml" title="walljay的备忘博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main"><article id="post-JS多文件下载" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JS多文件下载
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/09/08/JS多文件下载/" class="article-date">
  <time datetime="2016-09-08T06:09:01.000Z" itemprop="datePublished">2016-09-08</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="js&#x4E0B;&#x8F7D;"><a href="#js&#x4E0B;&#x8F7D;" class="headerlink" title="js&#x4E0B;&#x8F7D;"></a>js&#x4E0B;&#x8F7D;</h3><pre><code>/**
 * Javascript &#x591A;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;
 * @author Barret Lee
 * @email  barret.china@gmail.com
 */
var Downer = (function(files) {
var h5Down = !/Trident|MSIE/.test(navigator.userAgent);
// try{
//     h5Down = document.createElement(&quot;a&quot;).hasOwnProperty(&quot;download&quot;);
// } catch(e){
//     h5Down = document.createElement(&quot;a&quot;).download;
// }

/**
 * &#x5728;&#x652F;&#x6301; download &#x5C5E;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5355;&#x4E2A;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;
 * &#x76EE;&#x524D; FF &#x8FD8;&#x4E0D;&#x652F;&#x6301; download &#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5; FF &#x5FC5;&#x987B;&#x53E6;&#x89C5;&#x4ED6;&#x6CD5;&#xFF01;
 * @param  {String} fileName
 * @param  {String|FileObject} contentOrPath
 * @return {Null}
 */
function downloadFile(fileName, contentOrPath) {
    var aLink = document.createElement(&quot;a&quot;),
        evt = document.createEvent(&quot;HTMLEvents&quot;),
        isData = contentOrPath.slice(0, 5) === &quot;data:&quot;,
        isPath = contentOrPath.lastIndexOf(&quot;.&quot;) &gt; -1;

    // &#x521D;&#x59CB;&#x5316;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;
    // &#x6CE8;&#xFF1A;initEvent &#x4E0D;&#x52A0;&#x540E;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5728;FF&#x4E0B;&#x4F1A;&#x62A5;&#x9519;
    evt.initEvent(&quot;click&quot;, false, false);

    // &#x6DFB;&#x52A0;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x540D;
    aLink.download = fileName;

    // &#x5982;&#x679C;&#x662F; path &#x6216;&#x8005; dataURL &#x76F4;&#x63A5;&#x8D4B;&#x503C;
    // &#x5982;&#x679C;&#x662F; file &#x6216;&#x8005;&#x5176;&#x4ED6;&#x5185;&#x5BB9;&#xFF0C;&#x4F7F;&#x7528; Blob &#x8F6C;&#x6362;
    aLink.href = isPath || isData ? contentOrPath : URL.createObjectURL(new Blob([contentOrPath]));

    aLink.dispatchEvent(evt);
}

/**
 * [IEdownloadFile description]
 * @param  {String} fileName
 * @param  {String|FileObject} contentOrPath
 */
function IEdownloadFile(fileName, contentOrPath, bool) {
    var isImg = contentOrPath.slice(0, 10) === &quot;data:image&quot;,
        ifr = document.createElement(&apos;iframe&apos;);

    ifr.style.display = &apos;none&apos;;
    ifr.src = contentOrPath;

    document.body.appendChild(ifr);

    // dataURL &#x7684;&#x60C5;&#x51B5;
    isImg &amp;&amp; ifr.contentWindow.document.write(&quot;&lt;img src=&apos;&quot; +
        contentOrPath + &quot;&apos; /&gt;&quot;);

    // &#x4FDD;&#x5B58;&#x9875;&#x9762; -&gt; &#x4FDD;&#x5B58;&#x6587;&#x4EF6;
    // alert(ifr.contentWindow.document.body.innerHTML)
    if (bool) {
        ifr.contentWindow.document.execCommand(&apos;SaveAs&apos;, false, fileName);
        document.body.removeChild(ifr);
    } else {
        setTimeout(function() {
            ifr.contentWindow.document.execCommand(&apos;SaveAs&apos;, false, fileName);
            document.body.removeChild(ifr);
        }, 0);
    }
}

/**
 * [parseURL description]
 * @param  {String} str [description]
 * @return {String}     [description]
 */
function parseURL(str) {
    return str.lastIndexOf(&quot;/&quot;) &gt; -1 ? str.slice(str.lastIndexOf(&quot;/&quot;) + 1) : str;
}

return function(files) {
    // &#x9009;&#x62E9;&#x4E0B;&#x8F7D;&#x51FD;&#x6570;
    var downer = h5Down ? downloadFile : IEdownloadFile;

    // &#x5224;&#x65AD;&#x7C7B;&#x578B;&#xFF0C;&#x5904;&#x7406;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;&#x540D;
    if (files instanceof Array) {
        for (var i = 0, l = files.length; i &lt; l; i++)
        // bug &#x5904;&#x7406;
            downer(parseURL(files[i]), files[i], true);
    } else if (typeof files === &quot;string&quot;) {
        downer(parseURL(files), files);
    } else {
        // &#x5BF9;&#x8C61;
        for (var file in files) downer(file, files[file]);
    }
}

})();    
</code></pre>
      

      
        
    </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/08/git常用命令/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          git常用命令
        
      </div>
    </a>
  
  
    <a href="/2016/09/08/docker常用命令/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">docker常用命令</div>
    </a>
  
</nav>

  
</article>

</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  			<li><a href="https://github.com/" target="_blank"><i class="icon icon-github"></i></a></li>
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>
      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	  &copy; 2017 walljay 
	  - Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	  - Theme <a href="https://github.com/Alex-fun/hexo-theme-jane/" target="_blank">Jane</a>
	</div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
    <a href="https://github.com/" class="mobile-nav-link">Github</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>